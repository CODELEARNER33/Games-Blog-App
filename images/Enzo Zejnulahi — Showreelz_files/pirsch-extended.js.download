(()=>{function D(t){let i=document.querySelector(t);if(!i)throw`Pirsch script ${t} tag not found!`;return i}function c(t,i){let e="";return t.length>0&&(i<t.length?e=t[i]:e=t[t.length-1]),e}function k(t){let i={};for(let e of t.attributes)e.name.startsWith("data-tag-")?i[e.name.substring(9).replaceAll("-"," ")]=e.value||"1":e.name.startsWith("data-tag")&&e.value&&e.value.split(",").forEach(n=>{n=n.trim().replaceAll("-"," "),n&&(i[n]="1")});return i}function Q(t){return localStorage.getItem("disable_pirsch")||nt(t)||!rt(t)||at(t)}function E(t){return t?t=location.href.replace(location.hostname,t):t=location.href,t}function L(t,i,e){t||(t=location.href),i||(i=""),e||(e="");let n=new URL(t);return n.pathname=i+n.pathname+e,n.toString()}function C(t,i){let e=document.title;return t||(t=""),i||(i=""),t+e+i}function O(t){let i=document.referrer;return t&&(i=i.replace(location.hostname,t)),i}function nt(t){return!t.hasAttribute("data-dev")&&(/^localhost(.*)$|^127(\.[0-9]{1,3}){3}$/is.test(location.hostname)||location.protocol==="file:")?(console.info("Pirsch is ignored on localhost. Add the data-dev attribute to enable it."),!0):!1}function rt(t){try{let i=t.getAttribute("data-include"),e=i?i.split(","):[];if(e.length){let n=!1;for(let s=0;s<e.length;s++)if(new RegExp(e[s]).test(location.pathname)){n=!0;break}if(!n)return!1}}catch(i){console.error(i)}return!0}function at(t){try{let i=t.getAttribute("data-exclude"),e=i?i.split(","):[];for(let n=0;n<e.length;n++)if(new RegExp(e[n]).test(location.pathname))return!0}catch(i){console.error(i)}return!1}function $(t){if(history.pushState&&!t.disableHistory){let i=history.pushState;history.pushState=function(e,n,s){i.apply(this,[e,n,s]),T(t)},window.addEventListener("popstate",()=>T(t))}document.body?T(t):window.addEventListener("DOMContentLoaded",()=>T(t))}function T(t){let{script:i,domains:e,rewrite:n,pathPrefix:s,pathSuffix:d,titlePrefix:u,titleSuffix:f,identificationCode:o,endpoint:m,disableQueryParams:g,disableReferrer:x,disableResolution:v}=t;F({script:i,hostname:n,pathPrefix:e.length?"":c(s,0),pathSuffix:e.length?"":c(d,0),titlePrefix:e.length?"":c(u,0),titleSuffix:e.length?"":c(f,0),identificationCode:o,endpoint:m,disableQueryParams:g,disableReferrer:x,disableResolution:v});for(let l=0;l<e.length;l++)F({script:i,hostname:e[l],pathPrefix:c(s,l),pathSuffix:c(d,l),titlePrefix:c(u,l),titleSuffix:c(f,l),identificationCode:o,endpoint:m,disableQueryParams:g,disableReferrer:x,disableResolution:v})}function F(t){let{script:i,hostname:e,pathPrefix:n,pathSuffix:s,titlePrefix:d,titleSuffix:u,identificationCode:f,endpoint:o,disableQueryParams:m,disableReferrer:g,disableResolution:x}=t,v=O(e);e=E(e),e=L(e,n,s),m&&(e=e.includes("?")?e.split("?")[0]:e);let l=k(i),w=o+"?nc="+new Date().getTime()+"&code="+f+"&url="+encodeURIComponent(e.substring(0,1800))+"&t="+encodeURIComponent(C(d,u))+"&ref="+(g?"":encodeURIComponent(v))+"&w="+(x?"":screen.width)+"&h="+(x?"":screen.height)+(Object.keys(l).length?"&"+Object.entries(l).map(([A,b])=>`tag_${A.replaceAll("-"," ")}=${b||1}`).join("&"):""),P=new XMLHttpRequest;P.open("GET",w),P.send()}function M(){window.pirsch=function(t,i){return console.log(`Pirsch event: ${t}${i?" "+JSON.stringify(i):""}`),Promise.resolve(null)}}function V(t){let{script:i,domains:e,rewrite:n,pathPrefix:s,pathSuffix:d,titlePrefix:u,titleSuffix:f,identificationCode:o,endpoint:m,disableQueryParams:g,disableReferrer:x,disableResolution:v}=t;window.pirsch=function(l,w){return typeof l!="string"||!l?Promise.reject("The event name for Pirsch is invalid (must be a non-empty string)! Usage: pirsch('event name', {duration: 42, meta: {key: 'value'}})"):new Promise((P,A)=>{let b=w&&w.meta?w.meta:{};for(let h in b)b.hasOwnProperty(h)&&(b[h]=String(b[h]));j({script:i,hostname:n,pathPrefix:e.length?"":c(s,0),pathSuffix:e.length?"":c(d,0),titlePrefix:e.length?"":c(u,0),titleSuffix:e.length?"":c(f,0),identificationCode:o,endpoint:m,disableQueryParams:g,disableReferrer:x,disableResolution:v,name:l,options:w,meta:b,resolve:P,reject:A});for(let h=0;h<e.length;h++)j({script:i,hostname:e[h],pathPrefix:c(s,h),pathSuffix:c(d,h),titlePrefix:c(u,h),titleSuffix:c(f,h),identificationCode:o,endpoint:m,disableQueryParams:g,disableReferrer:x,disableResolution:v,name:l,options:w,meta:b,resolve:P,reject:A})})}}function j(t){let{script:i,hostname:e,pathPrefix:n,pathSuffix:s,titlePrefix:d,titleSuffix:u,identificationCode:f,endpoint:o,disableQueryParams:m,disableReferrer:g,disableResolution:x,name:v,options:l,meta:w,resolve:P,reject:A}=t,b=O(e),h=k(i);e=E(e),e=L(e,n,s),m&&(e=e.includes("?")?e.split("?")[0]:e),navigator.sendBeacon(o,JSON.stringify({identification_code:f,url:e.substring(0,1800),title:C(d,u),referrer:g?"":encodeURIComponent(b),screen_width:x?0:screen.width,screen_height:x?0:screen.height,tags:h,event_name:v,event_duration:l&&l.duration&&typeof l.duration=="number"?l.duration:0,event_meta:w}))?P():A("error queuing event request")}function B(t){let{script:i,domains:e,rewrite:n,pathPrefix:s,pathSuffix:d,identificationCode:u,endpoint:f,disableQueryParams:o}=t,m=Number.parseInt(i.getAttribute("data-interval-ms"),10)||6e4,g=setInterval(()=>{st({domains:e,rewrite:n,pathPrefix:s,pathSuffix:d,identificationCode:u,endpoint:f,disableQueryParams:o})},m);window.pirschClearSession=()=>{clearInterval(g)}}function st(t){let{domains:i,rewrite:e,pathPrefix:n,pathSuffix:s,identificationCode:d,endpoint:u,disableQueryParams:f}=t;z({hostname:e,pathPrefix:i.length?"":c(n,0),pathSuffix:i.length?"":c(s,0),identificationCode:d,endpoint:u,disableQueryParams:f});for(let o=0;o<i.length;o++)z({hostname:i[o],pathPrefix:c(n,o),pathSuffix:c(s,o),identificationCode:d,endpoint:u,disableQueryParams:f})}function z(t){let{hostname:i,pathPrefix:e,pathSuffix:n,identificationCode:s,endpoint:d,disableQueryParams:u}=t;i=E(i),i=L(i,e,n),u&&(i=i.includes("?")?i.split("?")[0]:i);let f=d+"?nc="+new Date().getTime()+"&code="+s+"&url="+encodeURIComponent(i.substring(0,1800)),o=new XMLHttpRequest;o.open("POST",f),o.send()}(function(){"use strict";M();let t=D("#pirschextendedjs");if(Q(t))return;let i=["7z","avi","csv","docx","exe","gz","key","midi","mov","mp3","mp4","mpeg","pdf","pkg","pps","ppt","pptx","rar","rtf","txt","wav","wma","wmv","xlsx","zip"].concat(t.getAttribute("data-download-extensions")?.split(",")||[]),e=t.getAttribute("data-hit-endpoint")||"https://api.pirsch.io/hit",n=t.getAttribute("data-event-endpoint")||"https://api.pirsch.io/event",s=t.getAttribute("data-session-endpoint")||"https://api.pirsch.io/session",d=t.getAttribute("data-code")||"not-set",u=t.getAttribute("data-domain")?t.getAttribute("data-domain").split(",")||[]:[],f=t.hasAttribute("data-disable-page-views"),o=t.hasAttribute("data-disable-query"),m=t.hasAttribute("data-disable-referrer"),g=t.hasAttribute("data-disable-resolution"),x=t.hasAttribute("data-disable-history"),v=t.hasAttribute("data-disable-outbound-links"),l=t.hasAttribute("data-disable-downloads"),w=t.hasAttribute("data-enable-sessions"),P=t.getAttribute("data-dev"),A=t.getAttribute("data-path-prefix")?t.getAttribute("data-path-prefix").split(",")||[]:[],b=t.getAttribute("data-path-suffix")?t.getAttribute("data-path-suffix").split(",")||[]:[],h=t.getAttribute("data-title-prefix")?t.getAttribute("data-title-prefix").split(",")||[]:[],I=t.getAttribute("data-title-suffix")?t.getAttribute("data-title-suffix").split(",")||[]:[],N=t.getAttribute("data-outbound-link-event-name")||"Outbound Link Click",q=t.getAttribute("data-download-event-name")||"File Download",J=t.getAttribute("data-not-found-event-name")||"404 Page Not Found";f||$({script:t,domains:u,rewrite:P,pathPrefix:A,pathSuffix:b,titlePrefix:h,titleSuffix:I,identificationCode:d,endpoint:e,disableQueryParams:o,disableReferrer:m,disableResolution:g,disableHistory:x}),w&&B({script:t,domains:u,rewrite:P,pathPrefix:A,pathSuffix:b,titlePrefix:h,titleSuffix:I,identificationCode:d,endpoint:s,disableQueryParams:o}),V({script:t,domains:u,rewrite:P,pathPrefix:A,pathSuffix:b,titlePrefix:h,titleSuffix:I,identificationCode:d,endpoint:n,disableQueryParams:o,disableReferrer:m,disableResolution:g}),window.pirschInit=function(){H("[data-pirsch-event]"),H("[pirsch-event]"),X(),G(),it()},document.addEventListener("DOMContentLoaded",pirschInit);function H(a){let r=document.querySelectorAll(a);for(let S of r)S.addEventListener("click",()=>{U(S)}),S.addEventListener("auxclick",()=>{U(S)})}function U(a){let r=a.getAttribute("pirsch-event")??a.getAttribute("data-pirsch-event");if(!r){console.error("Pirsch event attribute name can not be empty!",a);return}let S={},y;for(let p of a.attributes)p.name.startsWith("data-pirsch-meta-")?S[p.name.substring(17)]=p.value:p.name.startsWith("pirsch-meta-")?S[p.name.substring(12)]=p.value:(p.name.startsWith("data-pirsch-duration")||p.name.startsWith("pirsch-duration"))&&(y=Number.parseInt(p.value,10)??0);pirsch(r,{meta:S,duration:y})}function X(){let a=document.querySelectorAll("[class*='pirsch-event=']");for(let r of a)r.addEventListener("click",()=>{W(r)}),r.addEventListener("auxclick",()=>{W(r)})}function W(a){let r="",S={},y;for(let p of a.classList)if(p.startsWith("pirsch-event=")){if(r=p.substring(13).replaceAll("+"," "),!r){console.error("Pirsch event class name can not be empty!",a);return}}else if(p.startsWith("pirsch-meta-")){let _=p.substring(12);if(_){let R=_.split("=");R.length===2&&R[1]!==""&&(S[R[0]]=R[1].replaceAll("+"," "))}}else p.startsWith("pirsch-duration=")&&(y=Number.parseInt(p.substring(16))??0);pirsch(r,{meta:S,duration:y})}function G(){let a=document.getElementsByTagName("a");for(let r of a)!r.hasAttribute("pirsch-ignore")&&!r.hasAttribute("data-pirsch-ignore")&&!r.classList.contains("pirsch-ignore")&&(Z(r.href)?l||Y(r):v||K(r))}function K(a){let r=tt(a.href);r!==null&&r.hostname!==location.hostname&&(a.addEventListener("click",()=>pirsch(N,{meta:{url:r.href}})),a.addEventListener("auxclick",()=>pirsch(N,{meta:{url:r.href}})))}function Y(a){let r=et(a.href);a.addEventListener("click",()=>pirsch(q,{meta:{file:r}})),a.addEventListener("auxclick",()=>pirsch(q,{meta:{file:r}}))}function Z(a){let r=a.split(".").pop().toLowerCase();return i.includes(r)}function tt(a){try{return new URL(a)}catch{return null}}function et(a){try{return a.toLowerCase().startsWith("http")?new URL(a).pathname:a??"(empty)"}catch{return"(error)"}}function it(){window.pirschNotFound=function(){pirsch(J,{meta:{path:location.pathname}})}}})();})();
